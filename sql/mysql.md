
# MySQL 常用命令

请注意：

- 命令输入在 `mysql>` 之后；
- 命令用 `;` 或 `\g` 结束，换句话说，仅按 Enter 不执行命令；
- 输入 `help` 或 `\h` 获得帮助，也可以输入更多的文本获得特定命令的帮助（如，输入 `help select` 获得使用 `SELECT` 语句的帮助）；
- 输入 `quit` 或 `exit` 退出命令行实用程序。




## 连接 MySQL

```sql
mysql [-h 主机地址 [-P 端口号]] -u 用户名 -p[密码]
```

> ps：-h 和主机地址、-P 和端口号、-u 和用户名之间要不要空格都可以，但是，-p 和密码不能有空格。

## 列出所有的数据库

```sql
show databases;
```

## 选择数据库

```sql
use 数据库名;
```

## 列出所有的表

```sql
show tables;
```

## 查看表结构

```sql
desc 表名;
或
describe 表名;
或
show columns from 表名;
```

## 显示广泛的服务器状态信息

```sql
show status;
```

## 显示创建特定数据库或表的 MySQL 语句；

```sql
show create database 数据库名;
show create table 表名;
```




## distinct

`distinct` 关键字的主要作用就是对数据库表中一个或者多个字段重复的数据进行过滤。


## limit

```sql
select * from table_name limit 查询的条数 offset 起始索引(从0开始);
或
select * from table_name limit 起始索引(从0开始),查询的条数;
```
> 注意：两种方式的参数顺序不一样



## order by

注意：`ORDER BY` 子句的位置在指定一条 `ORDER BY` 子句时，应该保证它是 `SELECT` 语句中最后一条子句。如果它不是最后的子句，将会出错。

提示：通过非选择列进行排序通常，`ORDER BY` 子句中使用的列将是为显示而选择的列。但是，实际上并不一定要这样，用非检索的列排序数据是完全合法的。



## sql 查询慢的原因

- 数据查询过慢一般是索引问题，可能是因为选错索引，也可能是因为查询的行数太多。
- 客户端和数据库连接数过小，会限制sql的查询并发数，增大连接数可以提升速度。
- innodb里会有一层内存buffer pool用于提升查询速度，命中率一般>99%，如果低于这个值，可以考虑增大buffer pool的大小，这样也可以提升速度。
- 查询缓存（query cache）确实能为查询提速，但一般不建议打开，因为限制比较大，并且8.0以后的Mysql里已经将这个功能干掉了。









## 常用的文本处理函数

| 函数 | 说明 |
| --- | --- |
| LEFT()（或使用子字符串函数） |  返回字符串左边的字符 |
| LENGTH()（也使用DATALENGTH()或LEN()） |  返回字符串的长度 |
| LOWER() |  将字符串转换为小写 |
| LTRIM() |  去掉字符串左边的空格 |
| RIGHT()（或使用子字符串函数） | 返回字符串右边的字符 |
| RTRIM() |  去掉字符串右边的空格 |
| SUBSTR()或SUBSTRING() |  提取字符串的组成部分 |
| SOUNDEX() |  返回字符串的SOUNDEX值 |
| UPPER() |  将字符串转换为大写 |



## 日期和时间处理函数


| 函数 | 说明 |
| --- | --- |
| YEAR() | 从日期中提取年份 |
| MONTH() | 从日期中提取月份 |
| DAY() | 从日期中提取日 |


例如：查询2020年所有的订单：

```mysql
select * from tb_order where year(order_time) = 2020;

select * from tb_order where year(create_time) = 2020 and month(create_time) = 4 and day(create_time) = 3
```



## 数值处理函数


| 函数 | 说明 |
| --- | --- |
| ABS() | 返回一个数的绝对值 |
| COS() | 返回一个角度的余弦 |
| EXP() | 返回一个数的指数值 |
| PI() | 返回圆周率π 的值 |
| SIN() | 返回一个角度的正弦 |
| SQRT() | 返回一个数的平方根 |
| TAN() | 返回一个角度的正切 |



## 聚集函数


| 函数 | 说明 |
| --- | --- |
| AVG() | 返回某列的平均值 |
| COUNT() | 返回某列的行数 |
| MAX() | 返回某列的最大值 |
| MIN() | 返回某列的最小值 |
| SUM() | 返回某列值之和 |



> COUNT() 函数：说明:NULL 值，如果指定列名，则 COUNT() 函数会忽略指定列的值为NULL的行，但如果 COUNT() 函数中用的是星号（*)，则不忽略。
> MAX() 函数：提示：对非数值数据使用 MAX()，虽然 MAX() 一般用来找出最大的数值或日期值，但许多（并非所有） DBMS 允许将它用来返回任意列中的最大值，包括返回文本列中的最大值。在用于文本数据时，MAX() 返回按该列排序后的最后一行。说明：NULL 值 MAX()函数忽略列值为 NULL 的行。
> MIN() 函数：提示：对非数值数据使用 MIN() 虽然 MIN()一般用来找出最小的数值或日期值，但许多（并非所有） DBMS 允许将它用来返回任意列中的最小值，包括返回文本列中的最小值。在用于文本数据时，MIN()返回该列排序后最前面的行。说明：NULL 值 MIN()函数忽略列值为 NULL 的行。
> SUM() 函数：提示：在多个列上进行计算，如本例所示，利用标准的算术操作符，所有聚集函数都可用来执行多 个列上的计算。说明：NULL 值 SUM()函数忽略列值为 NULL 的行。


## 聚集不同值

- 对所有行执行计算，指定 ALL 参数或不指定参数（因为 ALL 是默认行为）。
- 只包含不同的值，指定 DISTINCT 参数。

> 提示：ALL 为默认， ALL 参数不需要指定，因为它是默认行为。如果不指定 DISTINCT，则假定为 ALL。
> 注意：DISTINCT 不能用于 COUNT(*) 如果指定列名，则 DISTINCT 只能用于 COUNT()。DISTINCT 不能用于 COUNT(*)。类似地，DISTINCT 必须使用列名，不能用于计算或表达式。
> 提示：将 DISTINCT 用于 MIN()和 MAX() 虽然 DISTINCT 从技术上可用于 MIN()和 MAX()，但这样做实际上没 有价值。一个列中的最小值和最大值不管是否只考虑不同值，结果都是相同的。
> 说明：其他聚集参数 除了这里介绍的 DISTINCT 和 ALL 参数，有的 DBMS 还支持其他参数， 如支持对查询结果的子集进行计算的 TOP 和 TOP PERCENT。为了解具体的 DBMS 支持哪些参数，请参阅相应的文档。



## 数据分组


在使用 GROUP BY 子句前，需要知道一些重要的规定。
- GROUP BY 子句可以包含任意数目的列，因而可以对分组进行嵌套，更细致地进行数据分组。
- 如果在 GROUP BY 子句中嵌套了分组，数据将在最后指定的分组上进行汇总。换句话说，在建立分组时，指定的所有列都一起计算（所以不能从个别的列取回数据）。
- GROUP BY 子句中列出的每一列都必须是检索列或有效的表达式（但不能是聚集函数）。如果在SELECT 中使用表达式，则必须在 GROUP BY 子句中指定相同的表达式。不能使用别名。
- 大多数SQL 实现不允许GROUP BY 列带有长度可变的数据类型（如文本或备注型字段）。
- 除聚集计算语句外，SELECT 语句中的每一列都必须在GROUP BY 子句中给出。
- 如果分组列中包含具有NULL 值的行，则NULL 将作为一个分组返回。如果列中有多行NULL 值，它们将分为一组。
- GROUP BY 子句必须出现在WHERE 子句之后，ORDER BY 子句之前。



**说明：HAVING 和 WHERE 的差别**

WHERE 过滤行，而 HAVING 过滤分组。
这里有另一种理解方法，WHERE 在数据分组前进行过滤，HAVING 在数据分组后进行过滤。这是一个重要的区别，WHERE 排除的行不包括在分组中。这可能会改变计算值，从而影响HAVING 子句中基于这些值过滤掉的分组。


**说明：使用HAVING 和 WHERE**

HAVING 与 WHERE 非常类似，如果不指定GROUP BY，则大多数DBMS会同等对待它们。不过，你自己要能区分这一点。使用HAVING 时应该结合GROUP BY 子句，而WHERE 子句用于标准的行级过滤。


**SELECT子句及其顺序**

| 子 句 | 说 明 | 是否必须使用 |
| --- | --- | :---: |
| SELECT | 要返回的列或表达式 | 是 |
| FROM | 从中检索数据的表 | 仅在从表选择数据时使用 |
| WHERE | 行级过滤 | 否 |
| GROUP BY | 分组说明 | 仅在按组计算聚集时使用 |
| HAVING | 组级过滤 | 否 |
| ORDER BY | 输出排序顺序 | 否 |




## 子查询

**注意：只能是单列**

作为子查询的SELECT 语句只能查询单个列。企图检索多个列将返回错误。

**注意：子查询和性能**

使用子查询并不总是执行这类数据检索的最有效方法。












